dataset = get_pixel_shift((28, 28), (16384, 2048), 128 * 2, 2048)
    model = FeedForwardVAE(784, 200, 4096 * 2, 3, in_channels=1).to(GLOBAL_DEVICE)
    schedule = Schedule(
        number_of_epochs=350,
        optimizer=optim.AdamW(model.parameters(), lr=1e-3),
    )
    schedule.manual_schedule(
        {
            "lr": scale_dict_values(
                {
                    0: 3e-4,
                    # 200: 1e-5,
                    # 300: 1e-3,
                    # 1000: 1e-4,
                    # 2050: 1e-3,
                    # 300: 6e-4,
                    # 400: 3e-4,
                },
                1e1,
            ),
            # "momentum": {120: 0.01},
        }
    )
    loss_func = ELBOLoss(0)
    metrics = Metrics({})  # {"MIG": MIG()})
    metric_values = run_experiment(dataset, schedule, model, loss_func, metrics)

    print(metric_values)
    # visualisation
    if not os.path.exists("data/images"):
        os.makedirs("data/images")

    test_performance_line(metric_values["loss"])
    # test_performance_line(metric_values["MIG"])
    example_images = [dataset.test_dataset[i][0].to(GLOBAL_DEVICE) for i in range(10)]
    vae_visual_appraisal(
        model, "MNIST_linear_full_beta-0", example_images, GLOBAL_DEVICE
    )

